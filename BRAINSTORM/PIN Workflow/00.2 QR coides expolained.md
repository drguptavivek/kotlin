You’re right to separate “how the APK gets on the tablet” from “how the team enrolls with the QR.” Think of it as two distinct QRs and two phases:

* **Phase A (OS-level provisioning):** Put the tablet in **Device Owner (DO)** mode and install SurveyLauncher.
  → This uses the **Android Setup QR** (handled by the OS during first-boot).
* **Phase B (App-level enrollment):** Bind the device to a Team/State on your server.
  → This uses **your Enrollment QR** (from your admin console).

Below is a concrete, field-ready sequence with roles, options, and exact order.

# End-to-end process (no pre-populated models required)

## 0) What admins prepare (once)

* Build/sign the SurveyLauncher APK (Device Owner capable).
* Publish the APK where tablets can fetch it (secure HTTPS URL or your asset CDN).
* In the admin console, generate **Enrollment QR batches** for each team (short-TTL JWTs). These will be scanned *after* the APK is on the device.

---

## Phase A — Getting SurveyLauncher on the device as Device Owner

### A1 **Android Setup QR (no MDM) – recommended for field teams**

**Who:** Your staging team (can be state ops team).
**When:** On brand-new or factory-reset tablets (Android 9+).

1. **Factory reset** the tablet (or receive it new from OEM).
2. Power on → at the “Hi there” screen, **tap the screen six times** (this opens the built-in QR scanner on most Android 9+ devices).
3. Scan your **Android Setup QR** (this is different from your Enrollment QR).

   * This Setup QR encodes:

     * **Download URL** of SurveyLauncher APK
     * Minimal provisioning extras (device owner package name, network setup if needed)
   * The OS downloads and installs SurveyLauncher and sets it as **Device Owner**.
4. The device boots into SurveyLauncher (now Home). You’re ready for **Phase B**.

> Note: This QR is not team-specific. It’s just a bootstrap that installs your APK and makes it DO.

### A2 **ADB provisioning (lab/staging line)**

**Who:** Your internal staging team with laptops.

1. Factory reset → connect via USB.
2. Run the standard DO provisioning ADB command sequence to set SurveyLauncher as the device owner (push APK, set DO component).
3. Hand over to field team for **Phase B**.

We **do not** pre-populate device models anywhere. The model will be captured automatically later during `/v1/provision`.

---

## Phase B — Team enrollment on your server (your Enrollment QR)

**Who:** State admin or national admin generates these; field staff/supervisors use them during handover.

1. In the admin console, create an **Enrollment Token batch** for each Team (e.g., 25 tokens, TTL 45 min).

   * The console shows a scannable **Enrollment QR** (URI like `surveylauncher://enroll?...` with a signed JWT).
   * Print or show on another device.

2. On the freshly provisioned tablet (already running SurveyLauncher as DO), open the app’s **Enroll Device** screen → **Scan Enrollment QR**.

3. SurveyLauncher validates the token locally (signature + time window) and calls **`/v1/provision`** with its **own facts** (manufacturer, model, OS, security patch, DO status, Android ID, etc.).

4. Server:

   * Redeems the token (one-time).
   * **Upserts DEVICE** (records model/OS automatically).
   * Applies **generic rules** (e.g., must be DO; min Android version).
   * Returns a **device_access_token**, time anchor, and current policy version/IDs.

5. SurveyLauncher pulls **signed policy**, applies kiosk allow-list, login windows, radios/background-data rules, etc.

6. Team login with **Team PIN** (or Supervisor PIN if needed) and start work.

---

## Who does what (quick roles view)

* **National/State Admins (central):**

  * Prepare **Android Setup QR** (Phase A) once (reusable).
  * Generate **Enrollment QR batches** per team (Phase B).
  * Rotate team PINs, monitor dashboards, revoke tokens if leaked.

* **Staging team (regional lab or vendor line):**

  * Execute **Phase A** on bulk tablets (A1 or A2 or A3).
  * Smoke test: device boots into SurveyLauncher as DO.

* **Field team / Supervisors (district level):**

  * Execute **Phase B** on site:

    * Scan **Enrollment QR** for the correct team.
    * Confirm device shows correct team name after `/v1/devices/me`.
    * First heartbeat/policy pull succeeds; kiosk rules active.
    * Team enters PIN and starts ODK/Browser/Custom app.

---

## Artifacts you’ll need to produce once

1. **Android Setup QR (Device Owner provisioning)**

   * Encodes: download URL for APK, package name, DO component, optional Wi-Fi.
   * Purpose: used at **first boot only** to install and set DO.
   * Reuse: same QR for thousands of devices if the APK URL stays stable.

2. **Enrollment QR (Team-scoped, short TTL)**

   * Encodes: signed JWT with `team_id`, `state_id`, `jti`, `exp`, etc.
   * Purpose: binds device to the **team** and seeds server trust.
   * Reuse: one-time; generate per-device or small batch per team.

3. **Printed/soft SOPs**

   * “How to scan Android Setup QR on first boot.”
   * “How to scan Enrollment QR after launcher loads.”
   * “Common errors & fixes” (expired token, no internet, camera blocked, time skew).

---

## Day-zero field checklist (single page)

* [ ] Tablet is new or factory-reset; battery > 50%.
* [ ] **Phase A:** Open setup QR scanner (tap 6×) → scan **Android Setup QR** → SurveyLauncher appears (DO mode confirmed).
* [ ] Join Wi-Fi/4G as needed.
* [ ] **Phase B:** In SurveyLauncher, tap **Enroll** → scan **Team Enrollment QR** (valid within TTL).
* [ ] App shows Team/State, policy version, and “Device approved”.
* [ ] Login with **Team PIN** → confirm whitelisted apps visible (ODK, Browser, Custom App).
* [ ] Do a quick **ODK test submission** and verify telemetry in dashboard.

---

## Why this satisfies your constraints

* **No pre-populated models:** Devices self-report at `/v1/provision`; server stores them.
* **Separation of duties:** One reusable **Android Setup QR** to install & set DO; many short-lived **Enrollment QRs** to bind to teams.
* **Scales to 1000+ devices:** Staging can run Phase A in batches; field teams only handle the short, safe Phase B.
* **Security:** Enrollment tokens are short TTL + single-use; devices are locked by DO policy immediately after Phase A.

If you want, I can draft both QR payload templates (the Setup QR spec and the Enrollment QR schema), plus a one-page printable SOP for Phase A and Phase B that your teams can carry into the field.
